<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Performance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .ticker {
            animation: scroll 30s linear infinite;
        }
        
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .dashboard-iframe {
            border: none;
            width: 100%;
            height: 100%;
        }
        
        /* Hide Looker Studio branding */
        .dashboard-iframe::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 200px;
            height: 30px;
            background: white;
            z-index: 10;
        }
        
        .iframe-container {
            position: relative;
            overflow: hidden;
        }
        
        .iframe-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 200px;
            height: 30px;
            background: #f8fafc;
            z-index: 10;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .iframe-container::after {
                width: 150px;
                height: 25px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-slate-900 text-white shadow-lg">
        <div class="px-4 py-3">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <h1 class="text-xl md:text-2xl font-semibold text-center md:text-left">Site Performance Dashboard</h1>
                
                <div class="flex flex-col md:flex-row items-center gap-4 text-sm">
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                        </svg>
                        <span id="location">New York, NY</span>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        <span id="current-time">--:-- --</span>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 2L13.09 8.26L20 9L15 13.74L16.18 20.02L10 16.77L3.82 20.02L5 13.74L0 9L6.91 8.26L10 2Z"/>
                        </svg>
                        <span id="weather">72¬∞F Sunny</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Header Ticker -->
        <div class="bg-slate-800 py-2 overflow-hidden">
            <div class="ticker whitespace-nowrap text-sm text-slate-300">
                <span class="inline-block px-8">üìç Current Location: New York, NY</span>
                <span class="inline-block px-8">üïê Local Time: <span id="ticker-time">--:-- --</span></span>
                <span class="inline-block px-8">üå§Ô∏è Weather: 72¬∞F, Sunny with light clouds</span>
                <span class="inline-block px-8">üìä Dashboard Status: Live Data Connected</span>
            </div>
        </div>
    </header>

    <!-- Main Dashboard Content -->
    <main class="flex-1 p-4 md:p-6">
        <div class="bg-white rounded-lg shadow-lg h-full">
            <div class="iframe-container h-full rounded-lg overflow-hidden">
                <iframe 
                    class="dashboard-iframe"
                    src="https://lookerstudio.google.com/embed/reporting/28da2412-8785-49f3-ad95-d9216c642e83/page/p_c5r3npwcvd" 
                    frameborder="0" 
                    style="border:0; min-height: 500px;" 
                    allowfullscreen 
                    sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox">
                </iframe>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white">
        <!-- Footer Ticker -->
        <div class="bg-slate-800 py-2 overflow-hidden">
            <div class="ticker whitespace-nowrap text-sm text-slate-300">
                <span class="inline-block px-8">üèóÔ∏è Safety First: Always wear proper PPE when working at heights</span>
                <span class="inline-block px-8">‚ö†Ô∏è AI Safety Tip: Inspect scaffolding daily for loose connections and wear points</span>
                <span class="inline-block px-8">üîß Maintenance Alert: Check guardrails and toe boards before each shift</span>
                <span class="inline-block px-8">üë∑ Safety Reminder: Three points of contact when climbing scaffolding</span>
                <span class="inline-block px-8">üìã Compliance: Ensure all scaffolding meets OSHA standards</span>
            </div>
        </div>
        
        <div class="px-4 py-3">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 text-sm text-slate-400">
                <p>&copy; 2024 Site Performance Dashboard. All rights reserved.</p>
                <p>Scaffolding Safety Lines - AI Generated Content</p>
            </div>
        </div>
    </footer>

    <script>
        let userTimezone = 'America/New_York';
        let userLocation = 'Loading...';
        let weatherData = { temp: '--', condition: 'Loading...' };

        // Update time with user's timezone
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                timeZone: userTimezone,
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            
            document.getElementById('current-time').textContent = timeString;
            document.getElementById('ticker-time').textContent = timeString;
        }

        // Get user's location and fetch weather
        async function getUserLocationAndWeather() {
            if (!navigator.geolocation) {
                console.log('Geolocation not supported');
                return;
            }

            try {
                // Get user's coordinates
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        timeout: 10000,
                        enableHighAccuracy: true
                    });
                });

                const { latitude, longitude } = position.coords;
                
                // Get location name using reverse geocoding
                await getLocationName(latitude, longitude);
                
                // Get weather data
                await getWeatherData(latitude, longitude);
                
                // Get timezone
                await getTimezone(latitude, longitude);
                
            } catch (error) {
                console.log('Location access denied or failed:', error);
                // Fallback to IP-based location
                await getLocationByIP();
            }
        }

        // Reverse geocoding to get location name
        async function getLocationName(lat, lon) {
            try {
                const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
                const data = await response.json();
                
                const city = data.city || data.locality || 'Unknown City';
                const region = data.principalSubdivision || data.countryName || '';
                userLocation = region ? `${city}, ${region}` : city;
                
                document.getElementById('location').textContent = userLocation;
                updateTicker();
            } catch (error) {
                console.log('Geocoding failed:', error);
            }
        }

        // Get weather data using Open-Meteo (free API)
        async function getWeatherData(lat, lon) {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit`);
                const data = await response.json();
                
                if (data.current_weather) {
                    const temp = Math.round(data.current_weather.temperature);
                    const weatherCode = data.current_weather.weathercode;
                    const condition = getWeatherCondition(weatherCode);
                    
                    weatherData = { temp: `${temp}¬∞F`, condition };
                    document.getElementById('weather').textContent = `${temp}¬∞F ${condition}`;
                    updateTicker();
                }
            } catch (error) {
                console.log('Weather fetch failed:', error);
                document.getElementById('weather').textContent = 'Weather unavailable';
            }
        }

        // Get timezone based on coordinates
        async function getTimezone(lat, lon) {
            try {
                // Using a simple timezone estimation based on longitude
                const timezoneOffset = Math.round(lon / 15);
                const timezones = {
                    '-8': 'America/Los_Angeles',
                    '-7': 'America/Denver',
                    '-6': 'America/Chicago',
                    '-5': 'America/New_York',
                    '0': 'Europe/London',
                    '1': 'Europe/Paris',
                    '8': 'Asia/Shanghai',
                    '9': 'Asia/Tokyo'
                };
                
                userTimezone = timezones[timezoneOffset.toString()] || 'America/New_York';
            } catch (error) {
                console.log('Timezone detection failed:', error);
            }
        }

        // Fallback: Get location by IP
        async function getLocationByIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                if (data.city && data.region) {
                    userLocation = `${data.city}, ${data.region}`;
                    document.getElementById('location').textContent = userLocation;
                    
                    // Get weather for IP location
                    if (data.latitude && data.longitude) {
                        await getWeatherData(data.latitude, data.longitude);
                        await getTimezone(data.latitude, data.longitude);
                    }
                    
                    updateTicker();
                }
            } catch (error) {
                console.log('IP location failed:', error);
                userLocation = 'Location unavailable';
                document.getElementById('location').textContent = userLocation;
            }
        }

        // Convert weather codes to readable conditions
        function getWeatherCondition(code) {
            const conditions = {
                0: 'Clear',
                1: 'Mostly Clear',
                2: 'Partly Cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Foggy',
                51: 'Light Drizzle',
                53: 'Drizzle',
                55: 'Heavy Drizzle',
                61: 'Light Rain',
                63: 'Rain',
                65: 'Heavy Rain',
                71: 'Light Snow',
                73: 'Snow',
                75: 'Heavy Snow',
                80: 'Light Showers',
                81: 'Showers',
                82: 'Heavy Showers',
                95: 'Thunderstorm'
            };
            
            return conditions[code] || 'Unknown';
        }

        // Update ticker with current data
        function updateTicker() {
            const tickerElement = document.querySelector('.ticker');
            if (tickerElement) {
                tickerElement.innerHTML = `
                    <span class="inline-block px-8">üìç Current Location: ${userLocation}</span>
                    <span class="inline-block px-8">üïê Local Time: <span id="ticker-time">--:-- --</span></span>
                    <span class="inline-block px-8">üå§Ô∏è Weather: ${weatherData.temp} ${weatherData.condition}</span>
                    <span class="inline-block px-8">üìä Dashboard Status: Live Data Connected</span>
                `;
            }
        }

        // Initialize everything
        async function initialize() {
            // Start time updates immediately
            updateTime();
            setInterval(updateTime, 1000);
            
            // Get location and weather
            await getUserLocationAndWeather();
            
            // Update weather every 10 minutes
            setInterval(getUserLocationAndWeather, 600000);
        }

        // Start when page loads
        initialize();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9700ba7725a97e93',t:'MTc1NTM0NTE3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
